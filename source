-- Iuri22 Hub | Combat Script (Aimbot + ESP + UI)

-- Serviços
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local mouse = player:GetMouse()
local camera = workspace.CurrentCamera

-- =========================
-- CONFIGURAÇÕES
-- =========================
local SETTINGS = {
        Aimbot = false,
        ESP = false,
        AimbotKey = Enum.UserInputType.MouseButton2, -- Botão direito
        FOV = 100,
        TeamCheck = true -- Evita mirar em aliados (se houver times)
}

local holdingAimKey = false

-- =========================
-- INTERFACE (GUI)
-- =========================

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "Cristian Painel"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player:WaitForChild("PlayerGui")

-- > Botão de Abrir/Fechar (Lateral)
local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Size = UDim2.new(0, 50, 0, 50)
ToggleButton.Position = UDim2.new(0, 10, 0.5, -25)
ToggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
ToggleButton.BorderSizePixel = 0
ToggleButton.Text = "Painel"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.TextSize = 14
ToggleButton.Parent = ScreenGui

local UICornerBtn = Instance.new("UICorner")
UICornerBtn.CornerRadius = UDim.new(0, 8)
UICornerBtn.Parent = ToggleButton

-- > Frame Principal
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 350, 0, 250)
MainFrame.Position = UDim2.new(0.5, -175, 0.5, -125)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainFrame.BorderSizePixel = 0
MainFrame.Visible = false -- Começa fechado
MainFrame.Parent = ScreenGui

local UICornerMain = Instance.new("UICorner")
UICornerMain.CornerRadius = UDim.new(0, 10)
UICornerMain.Parent = MainFrame

-- > Título
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -40, 0, 40)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "Cristian Painel"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = MainFrame

-- > Botão de Fechar (X)
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 14
CloseButton.Parent = MainFrame

local UICornerClose = Instance.new("UICorner")
UICornerClose.CornerRadius = UDim.new(0, 6)
UICornerClose.Parent = CloseButton

-- > Container dos Botões
local ButtonContainer = Instance.new("Frame")
ButtonContainer.Size = UDim2.new(1, -20, 1, -50)
ButtonContainer.Position = UDim2.new(0, 10, 0, 45)
ButtonContainer.BackgroundTransparency = 1
ButtonContainer.Parent = MainFrame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 10)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Parent = ButtonContainer

-- Função para criar botões de toggle
local function createToggle(text, callback)
        local Btn = Instance.new("TextButton")
        Btn.Size = UDim2.new(1, 0, 0, 40)
        Btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        Btn.Text = text
        Btn.TextColor3 = Color3.fromRGB(255, 255, 255)
        Btn.Font = Enum.Font.Gotham
        Btn.TextSize = 16
        Btn.Parent = ButtonContainer
        
        local Corner = Instance.new("UICorner")
        Corner.CornerRadius = UDim.new(0, 6)
        Corner.Parent = Btn
        
        local toggled = false
        
        Btn.MouseButton1Click:Connect(function()
                toggled = not toggled
                if toggled then
                        Btn.BackgroundColor3 = Color3.fromRGB(0, 170, 0) -- Verde
                        Btn.Text = text .. ": ON"
                else
                        Btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40) -- Cinza
                        Btn.Text = text
                end
                callback(toggled)
        end)
end

-- > Criando os botões de função
createToggle("AimBot (Botão Direito)", function(state)
        SETTINGS.Aimbot = state
end)

createToggle("ESP (Nome + HP)", function(state)
        SETTINGS.ESP = state
        -- Atualiza ESP imediatamente ao trocar
        for _, v in pairs(workspace:GetDescendants()) do
                if v.Name == "ESPGui" and v:IsA("BillboardGui") then
                        v.Enabled = state
                end
        end
end)

-- > Botão de "Ocultar HUD" (Esconde o botão lateral também, para prints/vídeos)
local HideAllButton = Instance.new("TextButton")
HideAllButton.Size = UDim2.new(1, 0, 0, 40)
HideAllButton.BackgroundColor3 = Color3.fromRGB(60, 60, 150)
HideAllButton.Text = "Ocultar Tudo (Tecla RightCtrl)"
HideAllButton.TextColor3 = Color3.fromRGB(255, 255, 255)
HideAllButton.Font = Enum.Font.Gotham
HideAllButton.TextSize = 14
HideAllButton.Parent = ButtonContainer

local CornerHide = Instance.new("UICorner")
CornerHide.CornerRadius = UDim.new(0, 6)
CornerHide.Parent = HideAllButton

-- =========================
-- LÓGICA DA UI
-- =========================

-- Arrastar Janela
local dragging, dragInput, dragStart, startPos
Title.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragging = true
                dragStart = input.Position
                startPos = MainFrame.Position
                
                input.Changed:Connect(function()
                        if input.UserInputState == Enum.UserInputState.End then
                                dragging = false
                        end
                end)
        end
end)

Title.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
                dragInput = input
        end
end)

UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
                local delta = input.Position - dragStart
                MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
end)

-- Botões de Abrir/Fechar
local guiVisible = false

local function toggleGui()
        guiVisible = not guiVisible
        MainFrame.Visible = guiVisible
end

ToggleButton.MouseButton1Click:Connect(toggleGui)
CloseButton.MouseButton1Click:Connect(toggleGui)

-- Ocultar Tudo (Botão e Interface)
local allHidden = false
HideAllButton.MouseButton1Click:Connect(function()
        allHidden = true
        ScreenGui.Enabled = false
end)

-- Tecla para reaparecer tudo (Right Control)
UserInputService.InputBegan:Connect(function(input, gp)
        if input.KeyCode == Enum.KeyCode.RightControl then
                allHidden = not allHidden
                ScreenGui.Enabled = not allHidden
        end
end)

-- =========================
-- SISTEMA AIMBOT
-- =========================

local currentTarget = nil

UserInputService.InputBegan:Connect(function(input, gp)
        if gp then return end
        if input.UserInputType == SETTINGS.AimbotKey then
                holdingAimKey = true
                currentTarget = nil -- Reseta o alvo ao clicar novamente
        end
end)

UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == SETTINGS.AimbotKey then
                holdingAimKey = false
                currentTarget = nil
        end
end)

local function getClosestPlayerToCursor()
        local closestPlayer = nil
        local shortestDistance = SETTINGS.FOV

        for _, v in pairs(Players:GetPlayers()) do
                if v ~= player and v.Character and v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0 and v.Character:FindFirstChild("Head") then
                        -- Team Check simples
                        if SETTINGS.TeamCheck and v.Team == player.Team and player.Team ~= nil then
                                continue
                        end

                        local pos, visible = camera:WorldToViewportPoint(v.Character.Head.Position)
                        if visible then
                                local magnitude = (Vector2.new(pos.X, pos.Y) - Vector2.new(mouse.X, mouse.Y)).Magnitude

                                if magnitude < shortestDistance then
                                        closestPlayer = v
                                        shortestDistance = magnitude
                                end
                        end
                end
        end

        return closestPlayer
end

RunService.RenderStepped:Connect(function()
        if SETTINGS.Aimbot and holdingAimKey then
                -- Se o alvo atual morrer ou sumir, tenta pegar outro
                if currentTarget and (not currentTarget.Character or not currentTarget.Character:FindFirstChild("Humanoid") or currentTarget.Character.Humanoid.Health <= 0) then
                        currentTarget = nil
                end

                -- Se não tiver alvo travado, busca o mais próximo
                if not currentTarget then
                        currentTarget = getClosestPlayerToCursor()
                end

                -- Se tiver alvo, mira nele
                if currentTarget and currentTarget.Character and currentTarget.Character:FindFirstChild("Head") then
                        -- Trava a câmera na cabeça (Lock On)
                        camera.CFrame = CFrame.new(camera.CFrame.Position, currentTarget.Character.Head.Position)
                end
        else
                currentTarget = nil
        end
end)

-- =========================
-- SISTEMA ESP
-- =========================

local function addESP(v)
        -- Remove ESP antigo se existir
        if v.Character and v.Character:FindFirstChild("Head") then
                if v.Character.Head:FindFirstChild("ESPGui") then
                        v.Character.Head.ESPGui:Destroy()
                end
                
                local bg = Instance.new("BillboardGui")
                bg.Name = "ESPGui"
                bg.Adornee = v.Character.Head
                bg.Size = UDim2.new(0, 100, 0, 50)
                bg.StudsOffset = Vector3.new(0, 2, 0)
                bg.AlwaysOnTop = true
                bg.Enabled = SETTINGS.ESP
                bg.Parent = v.Character.Head

                local name = Instance.new("TextLabel")
                name.Size = UDim2.new(1, 0, 0.5, 0)
                name.BackgroundTransparency = 1
                name.Text = v.Name
                name.TextColor3 = Color3.fromRGB(255, 255, 255)
                name.Font = Enum.Font.GothamBold
                name.TextSize = 12
                name.TextStrokeTransparency = 0.5
                name.Parent = bg
                
                local hp = Instance.new("TextLabel")
                hp.Size = UDim2.new(1, 0, 0.5, 0)
                hp.Position = UDim2.new(0, 0, 0.5, 0)
                hp.BackgroundTransparency = 1
                hp.TextColor3 = Color3.fromRGB(0, 255, 0)
                hp.Font = Enum.Font.GothamBold
                hp.TextSize = 12
                hp.TextStrokeTransparency = 0.5
                hp.Parent = bg

                -- Loop de atualização do HP
                local connection
                connection = RunService.RenderStepped:Connect(function()
                        if not v.Parent or not v.Character or not v.Character:FindFirstChild("Humanoid") then
                                connection:Disconnect()
                                bg:Destroy()
                                return
                        end
                        
                        bg.Enabled = SETTINGS.ESP
                        
                        local health = v.Character.Humanoid.Health
                        local maxHealth = v.Character.Humanoid.MaxHealth
                        hp.Text = math.floor(health) .. " / " .. math.floor(maxHealth)
                        
                        -- Cor baseada na vida
                        if health > (maxHealth * 0.5) then
                                hp.TextColor3 = Color3.fromRGB(0, 255, 0)
                        elseif health > (maxHealth * 0.2) then
                                hp.TextColor3 = Color3.fromRGB(255, 170, 0)
                        else
                                hp.TextColor3 = Color3.fromRGB(255, 0, 0)
                        end
                end)
        end
end

-- Adiciona ESP a jogadores existentes
for _, v in pairs(Players:GetPlayers()) do
        if v ~= player then
                addESP(v)
                v.CharacterAdded:Connect(function()
                        task.wait(1)
                        addESP(v)
                end)
        end
end

-- Adiciona ESP a novos jogadores
Players.PlayerAdded:Connect(function(v)
        v.CharacterAdded:Connect(function()
                task.wait(1)
                addESP(v)
        end)
end)
